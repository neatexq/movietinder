<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Tinder: Fixed Flip</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0a0a0b; --card-bg: #16161a; --accent: #ff2e4d; --text: #efefef; --gray: #888; --gold: #f5c518; --blue: #2e93ff; }
        
        body { font-family: 'Manrope', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        header { width: 100%; background: #000; display: flex; justify-content: center; gap: 40px; padding: 15px 0; border-bottom: 1px solid #222; flex-shrink: 0; }
        .nav-link { cursor: pointer; opacity: 0.5; transition: 0.3s; font-weight: 800; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .nav-link.active { opacity: 1; color: var(--accent); }

        #app-root { display: flex; flex: 1; overflow: hidden; width: 100%; }

        main { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; background: radial-gradient(circle at top, #1a1a2e 0%, #0a0a0b 100%); }
        .movie-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; align-items: center; }

        .sidebar { width: 320px; background: #111114; border-left: 1px solid #222; padding: 25px; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; flex-shrink: 0; }
        .filter-item { display: flex; flex-direction: column; gap: 8px; }
        .filter-item label { font-size: 11px; color: var(--gray); font-weight: 800; text-transform: uppercase; }
        .filter-item input, .filter-item select { background: #2a2a32; border: 1px solid #333; color: white; padding: 12px; border-radius: 10px; font-family: inherit; outline: none; }

        /* --- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø 3D –°–¶–ï–ù–ê --- */
        .card-scene { perspective: 1200px; width: 380px; height: 530px; cursor: pointer; position: relative; }
        
        .card-body { 
            width: 100%; height: 100%; 
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* –î–æ–±–∞–≤–∏–ª –∫—Ä–∞—Å–∏–≤—É—é –ø—Ä—É–∂–∏–Ω–∏—Å—Ç–æ—Å—Ç—å */
            transform-style: preserve-3d; 
            position: relative; 
        }
        
        .card-body.is-flipped { transform: rotateY(180deg); }
        
        .card-side { 
            position: absolute; width: 100%; height: 100%; 
            backface-visibility: hidden; 
            -webkit-backface-visibility: hidden; /* –î–ª—è Safari */
            border-radius: 30px; overflow: hidden; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.6); 
            border: 1px solid rgba(255,255,255,0.1); 
        }

        /* –õ–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ */
        .side-front { background: #000; transform: rotateY(0deg); }
        
        /* –ó–∞–¥–Ω—è—è —Å—Ç–æ—Ä–æ–Ω–∞ */
        .side-back { 
            background: #16161a; 
            transform: rotateY(180deg); 
            padding: 30px; 
            box-sizing: border-box; 
            display: flex; 
            flex-direction: column; 
            border: 1px solid var(--accent); 
        }

        .poster-img { width: 100%; height: 100%; object-fit: cover; }
        
        /* –†–µ–π—Ç–∏–Ω–≥: –∏—Å—á–µ–∑–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–µ */
        .rating-box { 
            position: absolute; top: 20px; right: 20px; 
            background: rgba(0,0,0,0.85); padding: 8px 15px; border-radius: 12px; 
            color: var(--gold); font-weight: 800; border: 1px solid var(--gold); 
            z-index: 10; text-align: right;
            transition: opacity 0.2s ease;
        }
        /* –ö–æ–≥–¥–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞, —Å–∫—Ä—ã–≤–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –ø—Ä–æ—Å–≤–µ—á–∏–≤–∞–ª */
        .card-body.is-flipped .rating-box { opacity: 0; pointer-events: none; }

        .movie-info-bottom { position: absolute; bottom: 0; left: 0; right: 0; padding: 30px 20px; background: linear-gradient(transparent, rgba(0,0,0,0.95)); }
        
        .genre-list { display: flex; flex-wrap: wrap; gap: 6px; margin: 8px 0 0 0; }
        .genre-tag { font-size: 10px; background: rgba(255,255,255,0.15); color: #fff; padding: 3px 8px; border-radius: 6px; text-transform: uppercase; font-weight: 600; border: 1px solid rgba(255,255,255,0.1); }

        .plot-text { line-height: 1.6; color: #ccc; font-size: 14px; display: -webkit-box; -webkit-line-clamp: 7; -webkit-box-orient: vertical; overflow: hidden; margin: 0; }
        
        .control-btns { display: flex; gap: 20px; margin-top: 25px; align-items: center; }
        .btn-round { border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .btn-main { width: 70px; height: 70px; border-radius: 50%; font-size: 28px; }
        .btn-small { width: 55px; height: 55px; border-radius: 50%; font-size: 20px; }
        
        .btn-dislike { background: #fff; color: #ff2e4d; }
        .btn-like { background: var(--accent); color: #fff; }
        .btn-watched { background: var(--blue); color: #fff; }
        .btn-round:hover { transform: scale(1.15); }

        .trailer-group { display: flex; flex-direction: column; gap: 10px; margin-top: auto; }
        .btn-trailer { padding: 12px; border-radius: 10px; border: none; font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 11px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .modal-card { background: var(--card-bg); padding: 35px; border-radius: 30px; max-width: 600px; width: 100%; position: relative; border: 1px solid #333; }
        
        .fav-card { display: flex; gap: 15px; background: #1a1a22; padding: 12px; border-radius: 15px; margin-bottom: 12px; border: 1px solid #333; }
        .fav-card img { width: 60px; border-radius: 8px; }

        .error-msg { background: rgba(255,0,0,0.1); color: #ff5f5f; padding: 20px; border-radius: 15px; border: 1px solid red; text-align: center; }
    </style>
</head>
<body>

<div id="app">
    <header>
        <div class="nav-link" :class="{active: currentTab === 'matcher'}" @click="currentTab = 'matcher'">–ü–æ–¥–±–æ—Ä</div>
        <div class="nav-link" :class="{active: currentTab === 'favorites'}" @click="currentTab = 'favorites'">–õ–∞–π–∫–∏ ({{favorites.length}})</div>
    </header>

    <div id="app-root">
        <main>
            <div v-if="apiError" class="error-msg">
                <b>–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞!</b><br>–í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à API KEY –≤ –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 302).
            </div>

            <div v-if="currentTab === 'matcher' && !apiError" class="movie-container">
                <div v-if="loading" style="margin-top: 100px;">–ò—â–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç...</div>

                <div v-else-if="currentMovie" class="card-scene" @click="isFlipped = !isFlipped">
                    <div class="card-body" :class="{'is-flipped': isFlipped}">
                        
                        <div class="card-side side-front">
                            <div class="rating-box">
                                ‚≠ê {{ currentMovie.vote_average }}<br>
                                <small style="font-size:9px; opacity:0.7;">üó£ {{ formatVotes(currentMovie.vote_count) }}</small>
                            </div>
                            <img :src="'https://image.tmdb.org/t/p/w500' + currentMovie.poster_path" class="poster-img">
                            <div class="movie-info-bottom">
                                <h2 style="margin:0; font-size: 1.6rem;">{{ currentMovie.title || currentMovie.name }}</h2>
                                <p style="color:#aaa; margin: 5px 0 0 0; font-size: 0.85rem;">{{ getYear(currentMovie) }} ‚Ä¢ {{ runtimeInfo }}</p>
                                <div class="genre-list">
                                    <span v-for="gid in currentMovie.genre_ids" :key="gid" class="genre-tag">{{ genreMap[gid] || '...' }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="card-side side-back">
                            <h3 style="margin: 0 0 10px 0; color: var(--accent); font-size: 14px;">–°–Æ–ñ–ï–¢</h3>
                            <p class="plot-text">{{ currentMovie.overview || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.' }}</p>
                            <button v-if="currentMovie.overview && currentMovie.overview.length > 200" class="btn-trailer" style="background:none; color:var(--accent); text-align:left; padding:0" @click.stop="showFullDescription = true">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ</button>
                            
                            <div class="trailer-group">
                                <button v-if="trailerRu" class="btn-trailer" style="background: var(--accent); color: white;" @click.stop="watchTrailer(trailerRu)">‚ñ∂ –¢—Ä–µ–π–ª–µ—Ä RU</button>
                                <button v-if="trailerEn" class="btn-trailer" style="background: white; color: black;" @click.stop="watchTrailer(trailerEn)">‚ñ∂ Trailer EN</button>
                                <div v-if="!trailerRu && !trailerEn" style="text-align:center; color:#555; font-size:12px; margin-top:10px;">–¢—Ä–µ–π–ª–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="control-btns" v-if="currentMovie && !loading">
                    <button class="btn-round btn-main btn-dislike" @click="nextMovie">‚úï</button>
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <button class="btn-round btn-small btn-watched" @click="markAsWatched">üëÅ</button>
                        <span style="font-size:10px; font-weight:800; margin-top:4px; color:var(--gray); text-transform:uppercase;">–°–º–æ—Ç—Ä–µ–ª</span>
                    </div>
                    <button class="btn-round btn-main btn-like" @click="saveToFavs">‚ù§</button>
                </div>
            </div>

            <div v-if="currentTab === 'favorites'" style="width: 100%; max-width: 500px;">
                <h2 style="margin-bottom: 20px;">–ú–æ–π —Å–ø–∏—Å–æ–∫</h2>
                <div v-for="fav in favorites" :key="fav.id" class="fav-card">
                    <img :src="'https://image.tmdb.org/t/p/w200' + fav.poster_path">
                    <div>
                        <h4 style="margin: 0 0 5px 0;">{{ fav.title || fav.name }}</h4>
                        <p style="color: var(--gold); margin: 0; font-size: 13px;">‚≠ê {{ fav.vote_average }} ({{ getYear(fav) }})</p>
                        <button @click="removeFromFavs(fav.id)" style="background:none; border:none; color:red; padding:0; cursor:pointer; font-size:11px; margin-top:5px;">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </main>

        <aside v-if="currentTab === 'matcher'" class="sidebar">
            <h3 style="margin:0;">–§–∏–ª—å—Ç—Ä—ã</h3>
            <div class="filter-item">
                <label>–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
                <select v-model="filters.type" @change="onTypeChange">
                    <option value="movie">–§–∏–ª—å–º—ã</option>
                    <option value="tv">–°–µ—Ä–∏–∞–ª—ã</option>
                </select>
            </div>
            
            <div class="filter-item">
                <label>–ñ–∞–Ω—Ä</label>
                <select v-model="filters.genre" @change="refreshData">
                    <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                    <option v-for="g in currentGenreList" :key="g.id" :value="g.id">{{ g.name }}</option>
                </select>
            </div>

            <div class="filter-item">
                <label>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å (–≥–æ–ª–æ—Å–∞)</label>
                <select v-model="filters.minVotes" @change="refreshData">
                    <option value="100">–õ—é–±—ã–µ (100+)</option>
                    <option value="500">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ (500+)</option>
                    <option value="2000">–ò–∑–≤–µ—Å—Ç–Ω—ã–µ (2000+)</option>
                    <option value="5000">–ú–∏—Ä–æ–≤—ã–µ —Ö–∏—Ç—ã (5000+)</option>
                </select>
            </div>

            <div class="filter-item">
                <label>–ú–∏–Ω. —Ä–µ–π—Ç–∏–Ω–≥ ‚≠ê</label>
                <input type="number" v-model="filters.minRating" step="0.5" max="10">
            </div>

            <div class="filter-item">
                <label>–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ –æ—Ç</label>
                <input type="number" v-model="filters.yearFrom">
            </div>

            <button class="btn-trailer" style="background: var(--accent); color: white;" @click="refreshData">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <hr style="border:0; border-top:1px solid #333; width:100%">
            <p style="font-size:11px; color:var(--gray); text-align:center;">–í —Å–∫—Ä—ã—Ç—ã—Ö: {{watchedIds.length}} —à—Ç.</p>
        </aside>
    </div>

    <div v-if="showFullDescription" class="modal-overlay" @click="showFullDescription = false">
        <div class="modal-card" @click.stop>
            <h2 style="margin:0 0 15px 0; color:var(--accent);">{{ currentMovie.title || currentMovie.name }}</h2>
            <p style="line-height: 1.7; color: #ddd; max-height: 400px; overflow-y: auto;">{{ currentMovie.overview }}</p>
            <button class="btn-trailer" style="width: 100%; background: #333; color: white; margin-top: 20px;" @click="showFullDescription = false">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<script>
    const API_KEY = 'a9eafe991ab45b15460e48dd0781b152'; // <--- –í–°–¢–ê–í–ò–¢–¨ –ö–õ–Æ–ß –¢–£–¢

    new Vue({
        el: '#app',
        data: {
            currentTab: 'matcher', loading: true, apiError: false,
            movieList: [], movieIndex: 0, isFlipped: false, showFullDescription: false,
            runtimeInfo: '', trailerRu: null, trailerEn: null, 
            genreMap: {}, movieGenres: [], tvGenres: [], 
            favorites: JSON.parse(localStorage.getItem('mt_favs_v6') || '[]'),
            watchedIds: JSON.parse(localStorage.getItem('mt_watched_v6') || '[]'),
            filters: { type: 'movie', genre: '', minVotes: 500, minRating: 6.5, yearFrom: 2010 }
        },
        computed: {
            currentMovie() { return this.movieList[this.movieIndex]; },
            currentGenreList() { return this.filters.type === 'movie' ? this.movieGenres : this.tvGenres; }
        },
        mounted() {
            if (!API_KEY || API_KEY.includes('–í–ê–®_API')) { this.apiError = true; } 
            else { this.loadGenres(); this.refreshData(); }
        },
        methods: {
            async loadGenres() {
                try {
                    const [resM, resT] = await Promise.all([
                        axios.get(`https://api.themoviedb.org/3/genre/movie/list?api_key=${API_KEY}&language=ru-RU`),
                        axios.get(`https://api.themoviedb.org/3/genre/tv/list?api_key=${API_KEY}&language=ru-RU`)
                    ]);
                    this.movieGenres = resM.data.genres;
                    this.tvGenres = resT.data.genres;
                    [...this.movieGenres, ...this.tvGenres].forEach(g => this.$set(this.genreMap, g.id, g.name));
                } catch (e) {}
            },
            onTypeChange() {
                this.filters.genre = ''; 
                this.refreshData();
            },
            async refreshData() {
                this.loading = true;
                try {
                    const page = Math.floor(Math.random() * 5) + 1;
                    let url = `https://api.themoviedb.org/3/discover/${this.filters.type}?api_key=${API_KEY}&language=ru-RU&sort_by=popularity.desc&vote_count.gte=${this.filters.minVotes}&vote_average.gte=${this.filters.minRating}&primary_release_date.gte=${this.filters.yearFrom}-01-01&page=${page}`;
                    if (this.filters.genre) url += `&with_genres=${this.filters.genre}`;

                    const res = await axios.get(url);
                    this.movieList = res.data.results.filter(m => !this.watchedIds.includes(m.id));
                    this.movieIndex = 0;
                    if(this.movieList.length > 0) this.getMovieExtras();
                } catch (err) { this.apiError = true; }
                this.loading = false;
            },
            async getMovieExtras() {
                if (!this.currentMovie) return;
                this.isFlipped = false; this.trailerRu = null; this.trailerEn = null;
                const id = this.currentMovie.id;
                try {
                    const det = await axios.get(`https://api.themoviedb.org/3/${this.filters.type}/${id}?api_key=${API_KEY}&language=ru-RU`);
                    this.runtimeInfo = this.filters.type === 'movie' ? det.data.runtime + ' –º–∏–Ω.' : det.data.number_of_seasons + ' —Å–µ–∑.';
                    const vRu = await axios.get(`https://api.themoviedb.org/3/${this.filters.type}/${id}/videos?api_key=${API_KEY}&language=ru-RU`);
                    const tRu = vRu.data.results.find(v => v.type === 'Trailer');
                    if (tRu) this.trailerRu = 'https://www.youtube.com/watch?v=' + tRu.key;
                    const vEn = await axios.get(`https://api.themoviedb.org/3/${this.filters.type}/${id}/videos?api_key=${API_KEY}`);
                    const tEn = vEn.data.results.find(v => v.type === 'Trailer');
                    if (tEn) this.trailerEn = 'https://www.youtube.com/watch?v=' + tEn.key;
                } catch (e) {}
            },
            nextMovie() {
                this.movieIndex++;
                if (this.movieIndex >= this.movieList.length) this.refreshData();
                else this.getMovieExtras();
            },
            saveToFavs() {
                if (!this.favorites.find(m => m.id === this.currentMovie.id)) {
                    this.favorites.unshift(this.currentMovie);
                    localStorage.setItem('mt_favs_v6', JSON.stringify(this.favorites));
                }
                this.nextMovie();
            },
            markAsWatched() {
                this.watchedIds.push(this.currentMovie.id);
                localStorage.setItem('mt_watched_v6', JSON.stringify(this.watchedIds));
                this.nextMovie();
            },
            removeFromFavs(id) {
                this.favorites = this.favorites.filter(m => m.id !== id);
                localStorage.setItem('mt_favs_v6', JSON.stringify(this.favorites));
            },
            getYear(m) { return (m.release_date || m.first_air_date || '').split('-')[0]; },
            formatVotes(n) { return n > 1000 ? (n/1000).toFixed(1) + 'k' : n; },
            watchTrailer(url) { window.open(url, '_blank'); }
        }
    });
</script>
</body>

</html>
