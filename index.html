<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Movie Tinder Mobile</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0a0a0b; --card-bg: #16161a; --accent: #ff2e4d; --text: #efefef; --gray: #888; --gold: #f5c518; --blue: #2e93ff; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            font-family: 'Manrope', sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            height: -webkit-fill-available; /* –î–ª—è iOS */
            overflow: hidden; 
        }

        /* –®–∞–ø–∫–∞ */
        header { 
            width: 100%; 
            background: #000; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 15px 20px; 
            border-bottom: 1px solid #222; 
            flex-shrink: 0; 
            z-index: 100;
        }
        .nav-group { display: flex; gap: 20px; }
        .nav-link { cursor: pointer; opacity: 0.5; transition: 0.3s; font-weight: 800; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; }
        .nav-link.active { opacity: 1; color: var(--accent); }

        /* –ö–Ω–æ–ø–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è –º–æ–±–∏–ª–æ–∫ */
        .filter-toggle { display: none; background: #222; border: none; color: white; padding: 8px 15px; border-radius: 8px; font-weight: 800; font-size: 12px; cursor: pointer; }

        #app-root { display: flex; flex: 1; overflow: hidden; width: 100%; position: relative; }

        main { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 10px; 
            overflow-y: auto; 
            background: radial-gradient(circle at top, #1a1a2e 0%, #0a0a0b 100%); 
            width: 100%;
        }

        .movie-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; align-items: center; height: 100%; justify-content: center; }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å / –ú–µ–Ω—é —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        .sidebar { 
            width: 320px; 
            background: #111114; 
            border-left: 1px solid #222; 
            padding: 25px; 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
            overflow-y: auto; 
            flex-shrink: 0; 
            transition: transform 0.3s ease;
        }

        /* 3D –ö–ê–†–¢–û–ß–ö–ê */
        .card-scene { perspective: 1200px; width: 100%; max-width: 360px; aspect-ratio: 2/3; cursor: pointer; position: relative; }
        .card-body { width: 100%; height: 100%; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; position: relative; }
        .card-body.is-flipped { transform: rotateY(180deg); }
        .card-side { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; border-radius: 25px; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); }

        .side-front { background: #000; transform: rotateY(0deg); }
        .side-back { background: #16161a; transform: rotateY(180deg); padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; border: 1px solid var(--accent); }

        .poster-img { width: 100%; height: 100%; object-fit: cover; }
        
        .rating-box { 
            position: absolute; top: 15px; right: 15px; 
            background: rgba(0,0,0,0.85); padding: 6px 12px; border-radius: 10px; 
            color: var(--gold); font-weight: 800; border: 1px solid var(--gold); 
            z-index: 10; text-align: right; transition: opacity 0.2s ease;
        }
        .card-body.is-flipped .rating-box { opacity: 0; pointer-events: none; }

        .movie-info-bottom { position: absolute; bottom: 0; left: 0; right: 0; padding: 25px 15px; background: linear-gradient(transparent, rgba(0,0,0,0.95) 80%); }
        .movie-info-bottom h2 { font-size: 1.4rem; margin: 0; }

        .genre-list { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px; }
        .genre-tag { font-size: 9px; background: rgba(255,255,255,0.15); color: #fff; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; font-weight: 600; }

        .plot-text { line-height: 1.5; color: #ccc; font-size: 13px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 6; -webkit-box-orient: vertical; }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .control-btns { display: flex; gap: 15px; margin: 20px 0; align-items: center; }
        .btn-round { border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .btn-main { width: 65px; height: 65px; border-radius: 50%; font-size: 24px; }
        .btn-small { width: 50px; height: 50px; border-radius: 50%; font-size: 18px; }
        .btn-dislike { background: #fff; color: #ff2e4d; }
        .btn-like { background: var(--accent); color: #fff; }
        .btn-watched { background: var(--blue); color: #fff; }

        .trailer-group { display: flex; flex-direction: column; gap: 8px; margin-top: auto; }
        .btn-trailer { padding: 12px; border-radius: 10px; border: none; font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 10px; width: 100%; }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –î–õ–Ø –ú–û–ë–ò–õ–û–ö */
        @media (max-width: 768px) {
            .sidebar { 
                position: fixed; left: 0; top: 0; bottom: 0; z-index: 1000; 
                transform: translateX(-100%); width: 280px; box-shadow: 20px 0 50px rgba(0,0,0,0.8);
            }
            .sidebar.is-open { transform: translateX(0); }
            .filter-toggle { display: block; }
            
            .card-scene { width: 92vw; max-width: 340px; }
            .control-btns { gap: 25px; }
            .btn-main { width: 75px; height: 75px; } /* –ß—É—Ç—å –±–æ–ª—å—à–µ –Ω–∞ –º–æ–±–∏–ª–∫–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ */
        }

        /* –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é */
        .sidebar-overlay { 
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(0,0,0,0.7); z-index: 999; 
        }
        .sidebar-overlay.is-visible { display: block; }

        .fav-card { display: flex; gap: 12px; background: #1a1a22; padding: 10px; border-radius: 15px; margin-bottom: 10px; align-items: center; }
        .fav-card img { width: 50px; height: 75px; object-fit: cover; border-radius: 8px; }
    </style>
</head>
<body>

<div id="app">
    <header>
        <button class="filter-toggle" @click="mobileMenuOpen = true">–§–∏–ª—å—Ç—Ä—ã</button>
        <div class="nav-group">
            <div class="nav-link" :class="{active: currentTab === 'matcher'}" @click="currentTab = 'matcher'">–ü–æ–¥–±–æ—Ä</div>
            <div class="nav-link" :class="{active: currentTab === 'favorites'}" @click="currentTab = 'favorites'">–õ–∞–π–∫–∏ ({{favorites.length}})</div>
        </div>
        <div style="width: 60px;" class="filter-toggle"></div> </header>

    <div id="app-root">
        <div class="sidebar-overlay" :class="{'is-visible': mobileMenuOpen}" @click="mobileMenuOpen = false"></div>

        <main>
            <div v-if="apiError" class="error-msg">–û—à–∏–±–∫–∞ API –ö–ª—é—á–∞.</div>

            <div v-if="currentTab === 'matcher' && !apiError" class="movie-container">
                <div v-if="loading" style="margin-top: 50px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

                <div v-else-if="currentMovie" class="card-scene" @click="isFlipped = !isFlipped">
                    <div class="card-body" :class="{'is-flipped': isFlipped}">
                        
                        <div class="card-side side-front">
                            <div class="rating-box">
                                ‚≠ê {{ currentMovie.vote_average }}<br>
                                <small style="font-size:8px; opacity:0.7;">üó£ {{ formatVotes(currentMovie.vote_count) }}</small>
                            </div>
                            <img :src="'https://image.tmdb.org/t/p/w500' + currentMovie.poster_path" class="poster-img">
                            <div class="movie-info-bottom">
                                <h2>{{ currentMovie.title || currentMovie.name }}</h2>
                                <p style="color:#aaa; margin: 4px 0; font-size: 12px;">{{ getYear(currentMovie) }} ‚Ä¢ {{ runtimeInfo }}</p>
                                <div class="genre-list">
                                    <span v-for="gid in currentMovie.genre_ids" :key="gid" class="genre-tag">{{ genreMap[gid] || '...' }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="card-side side-back">
                            <h3 style="margin: 0 0 10px 0; color: var(--accent); font-size: 12px; text-transform: uppercase;">–°—é–∂–µ—Ç</h3>
                            <p class="plot-text">{{ currentMovie.overview || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.' }}</p>
                            <button v-if="currentMovie.overview && currentMovie.overview.length > 200" 
                                    class="btn-trailer" style="background:none; color:var(--accent); text-align:left; padding:0" 
                                    @click.stop="showFullDescription = true">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ...</button>
                            
                            <div class="trailer-group">
                                <button v-if="trailerRu" class="btn-trailer" style="background: var(--accent); color: white;" @click.stop="watchTrailer(trailerRu)">‚ñ∂ –¢—Ä–µ–π–ª–µ—Ä RU</button>
                                <button v-if="trailerEn" class="btn-trailer" style="background: white; color: black;" @click.stop="watchTrailer(trailerEn)">‚ñ∂ Trailer EN</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-btns" v-if="currentMovie && !loading">
                    <button class="btn-round btn-main btn-dislike" @click="nextMovie">‚úï</button>
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <button class="btn-round btn-small btn-watched" @click="markAsWatched">üëÅ</button>
                        <span style="font-size:9px; font-weight:800; margin-top:4px; color:var(--gray);">–°–ú–û–¢–†–ï–õ</span>
                    </div>
                    <button class="btn-round btn-main btn-like" @click="saveToFavs">‚ù§</button>
                </div>
            </div>

            <div v-if="currentTab === 'favorites'" style="width: 100%; max-width: 400px; padding: 10px;">
                <h2 style="font-size: 1.5rem;">–ú–æ–π —Å–ø–∏—Å–æ–∫</h2>
                <div v-for="fav in favorites" :key="fav.id" class="fav-card">
                    <img :src="'https://image.tmdb.org/t/p/w200' + fav.poster_path">
                    <div style="flex:1">
                        <h4 style="margin: 0; font-size: 14px;">{{ fav.title || fav.name }}</h4>
                        <p style="color: var(--gold); margin: 2px 0; font-size: 12px;">‚≠ê {{ fav.vote_average }} ({{ getYear(fav) }})</p>
                    </div>
                    <button @click="removeFromFavs(fav.id)" style="background:none; border:none; color:red; font-size:20px; cursor:pointer;">&times;</button>
                </div>
                <p v-if="favorites.length === 0" style="text-align:center; color:var(--gray); margin-top:40px;">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</p>
            </div>
        </main>

        <aside class="sidebar" :class="{'is-open': mobileMenuOpen}">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0;">–§–∏–ª—å—Ç—Ä—ã</h3>
                <button @click="mobileMenuOpen = false" class="filter-toggle">–ì–æ—Ç–æ–≤–æ</button>
            </div>
            
            <div class="filter-item">
                <label>–¢–∏–ø</label>
                <select v-model="filters.type" @change="onTypeChange">
                    <option value="movie">–§–∏–ª—å–º—ã</option>
                    <option value="tv">–°–µ—Ä–∏–∞–ª—ã</option>
                </select>
            </div>
            
            <div class="filter-item">
                <label>–ñ–∞–Ω—Ä</label>
                <select v-model="filters.genre" @change="refreshData">
                    <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                    <option v-for="g in currentGenreList" :key="g.id" :value="g.id">{{ g.name }}</option>
                </select>
            </div>

            <div class="filter-item">
                <label>–ú–∏–Ω–∏–º—É–º –≥–æ–ª–æ—Å–æ–≤ (–≥–æ–ª–æ—Å–∞)</label>
                <select v-model="filters.minVotes" @change="refreshData">
                    <option value="100">100+</option>
                    <option value="500">500+</option>
                    <option value="2000">2000+</option>
                    <option value="5000">5000+</option>
                </select>
            </div>

            <div class="filter-item">
                <label>–†–µ–π—Ç–∏–Ω–≥ –æ—Ç ‚≠ê</label>
                <input type="number" v-model="filters.minRating" step="0.5" max="10">
            </div>

            <div class="filter-item">
                <label>–ì–æ–¥ –æ—Ç</label>
                <input type="number" v-model="filters.yearFrom">
            </div>

            <button class="btn-trailer" style="background: var(--accent); color: white;" @click="applyFilters">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <p style="font-size:10px; color:var(--gray); text-align:center;">–°–∫—Ä—ã—Ç–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö: {{watchedIds.length}}</p>
        </aside>
    </div>

    <div v-if="showFullDescription" class="modal-overlay" @click="showFullDescription = false">
        <div class="modal-card" @click.stop>
            <h2 style="margin:0 0 15px 0; color:var(--accent); font-size: 1.2rem;">{{ currentMovie.title || currentMovie.name }}</h2>
            <p style="line-height: 1.6; color: #ddd; max-height: 60vh; overflow-y: auto; font-size: 14px;">{{ currentMovie.overview }}</p>
            <button class="btn-trailer" style="background: #333; color: white; margin-top: 20px;" @click="showFullDescription = false">–ù–∞–∑–∞–¥</button>
        </div>
    </div>
</div>

<script>
    const API_KEY = 'a9eafe991ab45b15460e48dd0781b152';

    new Vue({
        el: '#app',
        data: {
            currentTab: 'matcher', loading: true, apiError: false, mobileMenuOpen: false,
            movieList: [], movieIndex: 0, isFlipped: false, showFullDescription: false,
            runtimeInfo: '', trailerRu: null, trailerEn: null, 
            genreMap: {}, movieGenres: [], tvGenres: [], 
            favorites: JSON.parse(localStorage.getItem('mt_favs_v6') || '[]'),
            watchedIds: JSON.parse(localStorage.getItem('mt_watched_v6') || '[]'),
            filters: { type: 'movie', genre: '', minVotes: 500, minRating: 6.5, yearFrom: 2010 }
        },
        computed: {
            currentMovie() { return this.movieList[this.movieIndex]; },
            currentGenreList() { return this.filters.type === 'movie' ? this.movieGenres : this.tvGenres; }
        },
        mounted() {
            this.loadGenres(); 
            this.refreshData();
        },
        methods: {
            applyFilters() {
                this.mobileMenuOpen = false;
                this.refreshData();
            },
            async loadGenres() {
                try {
                    const [resM, resT] = await Promise.all([
                        axios.get(`https://api.themoviedb.org/3/genre/movie/list?api_key=${API_KEY}&language=ru-RU`),
                        axios.get(`https://api.themoviedb.org/3/genre/tv/list?api_key=${API_KEY}&language=ru-RU`)
                    ]);
                    this.movieGenres = resM.data.genres;
                    this.tvGenres = resT.data.genres;
                    [...this.movieGenres, ...this.tvGenres].forEach(g => this.$set(this.genreMap, g.id, g.name));
                } catch (e) {}
            },
            onTypeChange() {
                this.filters.genre = ''; 
                this.refreshData();
            },
            async refreshData() {
                this.loading = true;
                try {
                    const page = Math.floor(Math.random() * 8) + 1;
                    let url = `https://api.themoviedb.org/3/discover/${this.filters.type}?api_key=${API_KEY}&language=ru-RU&sort_by=popularity.desc&vote_count.gte=${this.filters.minVotes}&vote_average.gte=${this.filters.minRating}&primary_release_date.gte=${this.filters.yearFrom}-01-01&first_air_date.gte=${this.filters.yearFrom}-01-01&page=${page}`;
                    if (this.filters.genre) url += `&with_genres=${this.filters.genre}`;

                    const res = await axios.get(url);
                    this.movieList = res.data.results.filter(m => !this.watchedIds.includes(m.id));
                    this.movieIndex = 0;
                    if(this.movieList.length > 0) this.getMovieExtras();
                } catch (err) { this.apiError = true; }
                this.loading = false;
            },
            async getMovieExtras() {
                if (!this.currentMovie) return;
                this.isFlipped = false; this.trailerRu = null; this.trailerEn = null;
                const id = this.currentMovie.id;
                try {
                    const det = await axios.get(`https://api.themoviedb.org/3/${this.filters.type}/${id}?api_key=${API_KEY}&language=ru-RU`);
                    this.runtimeInfo = this.filters.type === 'movie' ? det.data.runtime + ' –º–∏–Ω.' : det.data.number_of_seasons + ' —Å–µ–∑.';
                    
                    const vRu = await axios.get(`https://api.themoviedb.org/3/${this.filters.type}/${id}/videos?api_key=${API_KEY}&language=ru-RU`);
                    const tRu = vRu.data.results.find(v => v.type === 'Trailer');
                    if (tRu) this.trailerRu = 'https://www.youtube.com/watch?v=' + tRu.key;

                    const vEn = await axios.get(`https://api.themoviedb.org/3/${this.filters.type}/${id}/videos?api_key=${API_KEY}`);
                    const tEn = vEn.data.results.find(v => v.type === 'Trailer');
                    if (tEn) this.trailerEn = 'https://www.youtube.com/watch?v=' + tEn.key;
                } catch (e) {}
            },
            nextMovie() {
                this.movieIndex++;
                if (this.movieIndex >= this.movieList.length) this.refreshData();
                else this.getMovieExtras();
            },
            saveToFavs() {
                if (!this.favorites.find(m => m.id === this.currentMovie.id)) {
                    this.favorites.unshift(this.currentMovie);
                    localStorage.setItem('mt_favs_v6', JSON.stringify(this.favorites));
                }
                this.nextMovie();
            },
            markAsWatched() {
                this.watchedIds.push(this.currentMovie.id);
                localStorage.setItem('mt_watched_v6', JSON.stringify(this.watchedIds));
                this.nextMovie();
            },
            removeFromFavs(id) {
                this.favorites = this.favorites.filter(m => m.id !== id);
                localStorage.setItem('mt_favs_v6', JSON.stringify(this.favorites));
            },
            getYear(m) { return (m.release_date || m.first_air_date || '').split('-')[0]; },
            formatVotes(n) { return n > 1000 ? (n/1000).toFixed(1) + 'k' : n; },
            watchTrailer(url) { window.open(url, '_blank'); }
        }
    });
</script>
</body>
</html>
